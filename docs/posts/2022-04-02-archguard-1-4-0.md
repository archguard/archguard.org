---
layout: default
parent: Posts
title:  "ArchGuard 1.4.0 å‘å¸ƒ"
categories:
- Blog
- ArchGuard
---

ArchGuard 1.4.0 ç‰ˆæœ¬ä¸»è¦å˜æ›´ï¼š

1. åŸºäº HTTP API çš„å¾®æœåŠ¡ç³»ç»Ÿåˆ†æ
2. ç‰ˆæœ¬ç®¡ç†å·¥å…·çš„é«˜é¢‘å˜æ›´å¯»æ‰¾æ”¯æŒ
3. å¤šè¯­è¨€ä»£ç æ‰«æçš„æ”¯æŒ

## åŸºäº API åˆ†æçš„æœåŠ¡åœ°å›¾

![API List](/assets/screenshots/archguard-20-apilist.png)

API åœ¨ ArchGuard å®šä¹‰ä¸ºä¸€ç§ `container-service`ï¼Œæä¾›æœåŠ¡æ—¶åˆ™ä¸º `container-resource`ï¼Œä½¿ç”¨å…¶å®ƒæœåŠ¡æ—¶åˆ™æ˜¯ `container-demand`ã€‚ è¯†åˆ«ä»£ç åœ¨ Scanner ä¸­ï¼š[https://github.com/archguard/code-scanner](https://github.com/archguard/code-scanner)

å½“å‰ç‰ˆæœ¬ä¸­çš„æ”¯æŒæƒ…å†µï¼š

- API æ¶ˆè´¹ç«¯ï¼šå‰ç«¯ Axiosã€UMI-Requestï¼Œåç«¯ï¼šJava Spring + RestTemplateã€Kotlin Spring + RestTemplate
- API ç”Ÿäº§ç«¯ï¼šæ”¯æŒ Java/Kotlin + Springã€C# + .Net

ç›¸å…³çš„ä¸»è¦ä»£ç æ–‡ä»¶ï¼š

 - CSharpApiAnalyser.kt
 - JavaApiAnalyser.kt
 - FrontendApiAnalyser.kt

### è¯†åˆ« resource

åœ¨ Javaã€Kotlin å’Œ C# ä¸­ï¼ŒResource ä¸»è¦æ˜¯é€šè¿‡è¯†åˆ« Annotation æ¥å®ç°çš„ï¼Œé€šè¿‡è¯†åˆ«æ˜¯å¦æœ‰ï¼š`RestController` å’Œ `RequestMapping`ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
@RestController
public class HelloController {
    @GetMapping("/")
    public String index() {
        return "Greetings from Spring Boot!";
    }
}
```

è¿™æ—¶å°±ä¼šè®¤ä¸ºæ˜¯ä¸€ç§ APIã€‚

### è¯†åˆ« demand

Demand ä¸»è¦æ˜¯åˆ†æ FunctionCall ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•è°ƒç”¨ï¼Œå¦‚ï¼š

```kotlin
ResponseEntity<Person[]> response = restTemplate.getForEntity("/springData/person", Person[].class);
return Arrays.asList(response.getBody());
```

æ ¹æ® `restTemplate.getForEntity`ï¼Œé¦–å…ˆéœ€è¦ç”¨åˆ° RestTemplate ç±»ï¼Œå…¶æ¬¡æ˜¯ get/post/delete/put å¼€å¤´çš„æ–¹æ³•ï¼Œéšåçš„å˜é‡åˆ™ä¼šå˜ä¸ºå¯¹åº”çš„æ–¹æ³•

å¯¹äº TypeScript ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼š

```typescript
axios<SystemEvaluationHistoryType[]>({
  baseURL,
  url: '/evaluations',
  method: "GET",
  })
```

## ä½“é‡-é«˜é¢‘å˜æ›´

è¯†åˆ«ä»£ç åœ¨ Scanner ä¸­ï¼š[https://github.com/archguard/code-scanner](https://github.com/archguard/code-scanner)

æ–°ç‰ˆæœ¬çš„ `scan_git` æ¨¡å—æ·»åŠ äº†è¯­è¨€çš„è¯†åˆ«å’Œé«˜é¢‘å˜æ›´çš„æ”¯æŒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Overview](/assets/screenshots/archguard-20-overview.png)

### é«˜é¢‘å˜æ›´

é«˜é¢‘å˜æ›´ä¸»è¦æ˜¯é€šè¿‡è¡Œæ•° + Git çš„ä¿®æ”¹èµ„æ–™æ¥è¿›è¡Œå¯è§†åŒ–ï¼Œæ·»åŠ äº†ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼šæ‰“å¼€æ–‡ä»¶ï¼Œç»Ÿè®¡è¡Œæ•°ã€‚

å”¯ä¸€æœ‰åŒºåˆ«çš„æ˜¯ï¼šç»Ÿè®¡çš„æ–‡ä»¶åªä¼šæ¥æºäº Git å†å²ä¸­çš„æ–‡ä»¶ã€‚å› æ­¤ï¼Œæ˜¯å¦ç¼–è¯‘ä¸ä¼šè¢«å½±å“ã€‚

### è¯­è¨€è¯†åˆ«

è¯­è¨€çš„è¯†åˆ«åŸºäºï¼š[https://github.com/boyter/scc](https://github.com/boyter/scc)ï¼Œä»ä¸­å‰¥ç¦»å‡º [languages.json](https://github.com/archguard/scanner/blob/master/scan_git/src/main/resources/languages.json) æ–‡ä»¶ã€‚

åœ¨ SCC çš„è®¾è®¡ä¸­ï¼Œä¸»è¦æ˜¯æ ¹æ®åç¼€åæ¥è¯†åˆ«ï¼š

1. å¦‚æœæ˜¯å½¢å¦‚ `.gitignore` çš„è¿™ç§ `.` å¼€å¤´æ–‡ä»¶ï¼Œåˆ™ä¼šè¯†åˆ«çœ‹æ˜¯å¦åœ¨ languages map ä¸­æœ‰å¯¹åº”çš„ç±»å‹ã€‚
2. å–æ–‡ä»¶åç»­ï¼Œä¼šåˆ¤æ–­æ˜¯å¦æœ‰åŒåç»­ï¼Œå³å¦‚ `types.d.ts` çš„å½¢å¼ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œåˆ™ä¼šè¿”å› `.d.ts`ï¼Œåˆ™ä¸æ˜¯æ­£å¸¸çš„ `.ts` æ–‡ä»¶
3. å…¶ä»–æƒ…å†µï¼Œå¦‚ shebang æ–‡ä»¶ï¼Œä¼šåœ¨ scc å¤„ç†ï¼Œä½†æ˜¯ä¸ä¼šåœ¨ scan_Git å¤„ç†

## å¤šè¯­è¨€æ‰«æ

åœ¨ 1.4.0 ç‰ˆæœ¬ä¸­ï¼Œ[Chapi](https://github.com/modernizing/chapi) å¯ä»¥æ”¯æŒ Bytecode Scanner çš„åŠŸèƒ½ï¼Œæ”¯æŒçš„è¯­è¨€çš„ç°çŠ¶ï¼š

| Features/Languages  | Java | Python | Go  | Kotlin | TypeScript | C   | C#  | Scala | C++ |
|---------------------|------|--------|-----|--------|------------|-----|-----|-------|-----|
| http api decl       | âœ…    | ğŸ†•     | ğŸ†•  | âœ…      | âœ…          | ğŸ†•  | ğŸ†•  | ğŸ†•    | ğŸ†•  |
| syntax parse        | âœ…    | âœ…      | âœ…   | âœ…      | âœ…          | ğŸ†•  | ğŸ†•  | âœ…     | ğŸ†•  |
| function call       | âœ…    | ğŸ†•     |     | âœ…      | âœ…          |     |     |       |     |
| arch/package        | âœ…    |        |     | âœ…      | âœ…          |     |     | âœ…     |     |
| real world validate | âœ…    |        |     | âœ…      | âœ…          |     |     |       |     |
| expression  (TBD)   |      |        |     |        |            |     |     |       |     |

æ‰€ä»¥ï¼Œåœ¨åˆ›å»ºç³»ç»Ÿçš„æ—¶å€™ï¼Œè¿›è¡Œä¸€äº›é…ç½®çš„æ—¶å€™ï¼Œéƒ½éœ€è¦æ ¹æ®è¯­è¨€æ¥é€‰æ‹©ã€‚

## å…¶å®ƒ

å…¶å®ƒåŠŸèƒ½ï¼š

- Casing æ£€æŸ¥åŠŸèƒ½ï¼ˆæš‚æ—¶æœªå¯ç”¨ï¼‰
- æ¥å…¥äº† Chapiï¼Œç”¨äºæ”¯æŒå¤šè¯­è¨€æ£€æŸ¥ï¼Œå½“å‰å·²æ”¯æŒ
- TBS ä½¿ç”¨ Chapi ä»£æ›¿äº† Coca
- åˆ›å»ºç³»ç»Ÿæ—¶ï¼Œå¯ä»¥é€‰æ‹©å…¶å®ƒè¯­è¨€
- æ”¯æŒ HTTP API è°ƒç”¨æ”¯æŒ
- API ä½¿ç”¨å’Œè°ƒç”¨æ¸…å•
- SCM æ”¯æŒå¯»æ‰¾é«˜é¢‘å˜æ›´æ–‡ä»¶
- æ•°æ®åº“åœ°å›¾

æ›´è¯¦ç»†è§ï¼šReleaseNotes [https://github.com/archguard/archguard/releases](https://github.com/archguard/archguard/releases)
